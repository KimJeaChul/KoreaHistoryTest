<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 페이지 - 한국사 기출문제 시스템</title>
    <style>
        body {
            font-family: 'Malgun Gothic', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .header {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .section h2 {
            color: #333;
            border-bottom: 3px solid #ff6b6b;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        input[type="text"], input[type="file"], textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }
        input[type="text"]:focus, textarea:focus, select:focus {
            border-color: #ff6b6b;
            outline: none;
        }
        .btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .btn-secondary {
            background: linear-gradient(45deg, #6c757d, #495057);
        }
        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #c82333);
        }
        .btn-success {
            background: linear-gradient(45deg, #28a745, #20c997);
        }
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .question-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .question-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #ff6b6b;
        }
        .bulk-management-tools {
            border: 1px solid #dee2e6;
        }
        .bulk-management-tools h4 {
            margin-bottom: 15px;
        }
        .question-number {
            font-weight: bold;
            color: #ff6b6b;
            font-size: 1.1em;
        }
        .question-text {
            margin-bottom: 15px;
            line-height: 1.6;
        }
        .question-score {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            margin-right: 8px;
        }
        .question-image {
            max-width: 200px;
            height: auto;
            border-radius: 8px;
            margin: 10px 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        .image-missing {
            background: #fff3cd;
            border: 2px dashed #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            text-align: center;
            color: #856404;
            font-weight: bold;
        }
        .image-missing::before {
            content: "🖼️ 이미지 누락";
            display: block;
            margin-bottom: 5px;
        }
        .options-list {
            list-style: none;
            padding: 0;
        }
        .options-list li {
            padding: 5px 0;
            color: #666;
        }
        .correct-answer {
            color: #28a745;
            font-weight: bold;
        }
        .nav-back {
            text-align: center;
            margin-bottom: 20px;
        }
        .nav-back a {
            color: #666;
            text-decoration: none;
            font-size: 1.1em;
        }
        .nav-back a:hover {
            color: #ff6b6b;
        }
        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            background: #fafafa;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        .upload-area:hover {
            border-color: #ff6b6b;
            background: #fff5f5;
        }
        .upload-area.uploaded {
            border-color: #28a745;
            background: #e8f5e8;
        }
        .upload-area.uploaded::after {
            content: "✅ 업로드 완료";
            display: block;
            color: #28a745;
            font-weight: bold;
            margin-top: 10px;
        }
        .file-input {
            display: none;
        }
        .file-label {
            cursor: pointer;
            color: #ff6b6b;
            font-weight: bold;
        }
        .upload-status {
            background: #e8f5e8;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            display: none;
        }
        .upload-status h3 {
            color: #28a745;
            margin: 0 0 10px 0;
        }
        .file-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .file-info h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .file-details {
            color: #666;
            font-size: 0.9em;
        }
        .processing-status {
            background: #e8f5e8;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            display: none;
        }
        .processing-status h3 {
            color: #28a745;
            margin: 0 0 10px 0;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #28a745, #20c997);
            width: 0%;
            transition: width 0.3s ease;
        }
        .auto-generated {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            color: #856404;
        }
        .auto-generated::before {
            content: "🤖 자동 생성된 문제";
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }
        .upload-buttons {
            text-align: center;
            margin-top: 20px;
        }
        .upload-buttons .btn {
            margin: 0 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav-back">
            <a href="Index.html">← 메인 페이지로 돌아가기</a>
        </div>
        
        <div class="header">
            <h1>관리자 페이지</h1>
            <p>한국사 기출문제 관리 시스템</p>
        </div>

        <!-- PDF 업로드 섹션 -->
        <div class="section">
            <h2>📄 PDF 파일 업로드 (자동 문제 생성)</h2>
            
            <!-- 문제지 업로드 -->
            <div class="upload-area" id="questionUploadArea">
                <h3>① 문제지</h3>
                <p>문제지 PDF 파일을 여기에 드래그하거나 클릭하여 업로드하세요</p>
                <input type="file" id="questionPDF" class="file-input" accept=".pdf">
                <label for="questionPDF" class="file-label">문제지 선택</label>
            </div>

            <!-- 정답지 업로드 -->
            <div class="upload-area" id="answerUploadArea">
                <h3>② 정답지</h3>
                <p>정답지 PDF 파일을 여기에 드래그하거나 클릭하여 업로드하세요</p>
                <input type="file" id="answerPDF" class="file-input" accept=".pdf">
                <label for="answerPDF" class="file-label">정답지 선택</label>
            </div>

            <!-- 업로드 상태 표시 -->
            <div class="upload-status" id="uploadStatus">
                <h3>📁 업로드 상태</h3>
                <div id="fileInfoContainer">
                    <!-- 파일 정보가 여기에 표시됩니다 -->
                </div>
            </div>

            <div class="form-group">
                <label for="examDate">시험 일자:</label>
                <input type="text" id="examDate" placeholder="예: 2024년 3월 9일">
            </div>
            <div class="form-group">
                <label for="examType">시험 유형:</label>
                <select id="examType">
                    <option value="">선택하세요</option>
                    <option value="일반">일반</option>
                    <option value="심화">심화</option>
                </select>
            </div>
            
            <div class="upload-buttons">
                <button class="btn btn-success" id="generateBtn" onclick="generateQuestions()" disabled>
                    📝 시험문제 생성하기
                </button>
                <button class="btn btn-secondary" onclick="resetUploads()">
                    🔄 업로드 초기화
                </button>
            </div>
            
            <!-- 처리 상태 표시 -->
            <div class="processing-status" id="processingStatus">
                <h3>📊 문제 생성 중...</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p id="processingMessage">PDF 파일을 분석하고 문제를 생성하고 있습니다...</p>
            </div>
        </div>

        <!-- 문제 등록 섹션 -->
        <div class="section">
            <h2>✏️ 수동 문제 등록</h2>
            <div class="form-group">
                <label for="questionText">문제 내용:</label>
                <textarea id="questionText" rows="4" placeholder="문제를 입력하세요"></textarea>
            </div>
            <div class="form-group">
                <label for="questionImage">문제 이미지 (선택사항):</label>
                <input type="file" id="questionImage" accept="image/*">
            </div>
            <div class="form-group">
                <label for="option1">보기 1:</label>
                <input type="text" id="option1" placeholder="첫 번째 보기">
            </div>
            <div class="form-group">
                <label for="option2">보기 2:</label>
                <input type="text" id="option2" placeholder="두 번째 보기">
            </div>
            <div class="form-group">
                <label for="option3">보기 3:</label>
                <input type="text" id="option3" placeholder="세 번째 보기">
            </div>
            <div class="form-group">
                <label for="option4">보기 4:</label>
                <input type="text" id="option4" placeholder="네 번째 보기">
            </div>
            <div class="form-group">
                <label for="correctAnswer">정답:</label>
                <select id="correctAnswer">
                    <option value="">선택하세요</option>
                    <option value="1">1번</option>
                    <option value="2">2번</option>
                    <option value="3">3번</option>
                    <option value="4">4번</option>
                </select>
            </div>
            <div class="form-group">
                <label for="examDateInput">시험 일자:</label>
                <input type="text" id="examDateInput" placeholder="예: 2024년 3월 9일">
            </div>
            <div class="form-group">
                <label for="examTypeInput">시험 유형:</label>
                <select id="examTypeInput">
                    <option value="">선택하세요</option>
                    <option value="일반">일반</option>
                    <option value="심화">심화</option>
                </select>
            </div>
            <div class="form-group">
                <label for="questionScore">문제 점수:</label>
                <select id="questionScore">
                    <option value="1">1점</option>
                    <option value="2">2점</option>
                    <option value="3">3점</option>
                </select>
            </div>
            <div class="form-group">
                <label for="questionExplanation">문제 해설 (선택사항):</label>
                <textarea id="questionExplanation" rows="4" placeholder="문제에 대한 해설을 입력하세요"></textarea>
            </div>
            <button class="btn" onclick="addQuestion()">문제 등록</button>
        </div>

        <!-- 문제 관리 섹션 -->
        <div class="section">
            <h2>📋 등록된 문제 관리</h2>
            
            <!-- 일괄 관리 도구 -->
            <div class="bulk-management-tools" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                <h4 style="margin-top: 0; color: #495057;">🔧 일괄 관리 도구</h4>
                
                <!-- 시험일자별 일괄 삭제 -->
                <div style="margin-bottom: 15px;">
                    <label for="examDateSelect">시험일자별 일괄 삭제:</label>
                    <select id="examDateSelect" style="width: auto; display: inline-block; margin: 0 10px;">
                        <option value="">시험일자 선택</option>
                    </select>
                    <button class="btn btn-danger" onclick="deleteQuestionsByDate()">선택된 시험일자 문제 일괄 삭제</button>
                </div>
                
                <!-- 일괄 선택 도구 -->
                <div style="margin-bottom: 15px;">
                    <button class="btn btn-secondary" onclick="selectAllQuestions()">전체 선택</button>
                    <button class="btn btn-secondary" onclick="deselectAllQuestions()">전체 해제</button>
                    <button class="btn btn-danger" onclick="deleteSelectedQuestions()">선택된 문제 삭제</button>
                </div>
                
                <!-- 선택된 문제 수 표시 -->
                <div id="selectedCount" style="color: #666; font-size: 0.9em;">
                    선택된 문제: 0개
                </div>
            </div>
            
            <div id="questionsList">
                <!-- 등록된 문제들이 여기에 표시됩니다 -->
            </div>
        </div>
    </div>

    <script>
        // 로컬 스토리지에서 문제 데이터 로드
        let questions = JSON.parse(localStorage.getItem('koreanHistoryQuestions')) || [];
        let examDates = JSON.parse(localStorage.getItem('examDates')) || [];
        
        // 업로드된 파일 정보
        let uploadedFiles = {
            questionPDF: null,
            answerPDF: null
        };

        // 페이지 로드 시 문제 목록 표시
        window.onload = function() {
            displayQuestions();
            setupFileUploads();
        };

        // 파일 업로드 설정
        function setupFileUploads() {
            const questionPDF = document.getElementById('questionPDF');
            const answerPDF = document.getElementById('answerPDF');

            questionPDF.addEventListener('change', (e) => handleFileUpload(e, 'questionPDF'));
            answerPDF.addEventListener('change', (e) => handleFileUpload(e, 'answerPDF'));
        }

        // 파일 업로드 처리
        function handleFileUpload(event, fileType) {
            const file = event.target.files[0];
            if (file && file.type === 'application/pdf') {
                uploadedFiles[fileType] = {
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    lastModified: file.lastModified
                };
                
                // 업로드 영역 스타일 변경
                const uploadArea = document.getElementById(fileType === 'questionPDF' ? 'questionUploadArea' : 'answerUploadArea');
                uploadArea.classList.add('uploaded');
                
                // 업로드 상태 표시
                updateUploadStatus();
                
                // 시험문제 생성 버튼 활성화 확인
                checkGenerateButton();
            } else {
                alert('PDF 파일만 업로드 가능합니다.');
                event.target.value = '';
            }
        }

        // 업로드 상태 표시
        function updateUploadStatus() {
            const uploadStatus = document.getElementById('uploadStatus');
            const fileInfoContainer = document.getElementById('fileInfoContainer');
            
            let html = '';
            
            if (uploadedFiles.questionPDF) {
                html += `
                    <div class="file-info">
                        <h4>✅ 문제지 업로드 완료</h4>
                        <div class="file-details">
                            파일명: ${uploadedFiles.questionPDF.name}<br>
                            크기: ${(uploadedFiles.questionPDF.size / 1024 / 1024).toFixed(2)} MB<br>
                            업로드 시간: ${new Date(uploadedFiles.questionPDF.lastModified).toLocaleString()}
                        </div>
                    </div>
                `;
            }
            
            if (uploadedFiles.answerPDF) {
                html += `
                    <div class="file-info">
                        <h4>✅ 정답지 업로드 완료</h4>
                        <div class="file-details">
                            파일명: ${uploadedFiles.answerPDF.name}<br>
                            크기: ${(uploadedFiles.answerPDF.size / 1024 / 1024).toFixed(2)} MB<br>
                            업로드 시간: ${new Date(uploadedFiles.answerPDF.lastModified).toLocaleString()}
                        </div>
                        <div class="answer-analysis-info" style="margin-top: 10px; padding: 10px; background: #e8f5e8; border-radius: 5px; border-left: 4px solid #28a745;">
                            <strong>📊 정답지 분석 정보:</strong><br>
                            • 정답번호 자동 추출: <span id="answerExtractionStatus">대기 중...</span><br>
                            • 추출된 정답 수: <span id="extractedAnswerCount">-</span><br>
                            • 분석 상태: <span id="analysisStatus">대기 중...</span>
                        </div>
                    </div>
                `;
            }
            
            fileInfoContainer.innerHTML = html;
            uploadStatus.style.display = 'block';
        }

        // 시험문제 생성 버튼 활성화 확인
        function checkGenerateButton() {
            const generateBtn = document.getElementById('generateBtn');
            if (uploadedFiles.questionPDF && uploadedFiles.answerPDF) {
                generateBtn.disabled = false;
                generateBtn.textContent = '📝 시험문제 생성하기 (문제지 + 정답지)';
            } else {
                generateBtn.disabled = true;
                generateBtn.textContent = '📝 시험문제 생성하기';
            }
        }

        // 업로드 초기화
        function resetUploads() {
            uploadedFiles = {
                questionPDF: null,
                answerPDF: null
            };
            
            // 파일 입력 초기화
            document.getElementById('questionPDF').value = '';
            document.getElementById('answerPDF').value = '';
            
            // 업로드 영역 스타일 초기화
            document.getElementById('questionUploadArea').classList.remove('uploaded');
            document.getElementById('answerUploadArea').classList.remove('uploaded');
            
            // 업로드 상태 숨기기
            document.getElementById('uploadStatus').style.display = 'none';
            
            // 시험문제 생성 버튼 비활성화
            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = true;
            generateBtn.textContent = '📝 시험문제 생성하기';
        }

        // 시험문제 생성
        function generateQuestions() {
            const examDate = document.getElementById('examDate').value;
            const examType = document.getElementById('examType').value;
            
            if (!examDate || !examType) {
                alert('시험 일자와 유형을 모두 입력해주세요.');
                return;
            }

            if (!uploadedFiles.questionPDF || !uploadedFiles.answerPDF) {
                alert('문제지와 정답지를 모두 업로드해주세요.');
                return;
            }

            // 처리 상태 표시
            const processingStatus = document.getElementById('processingStatus');
            const progressFill = document.getElementById('progressFill');
            const processingMessage = document.getElementById('processingMessage');
            
            processingStatus.style.display = 'block';
            progressFill.style.width = '0%';

            // 시뮬레이션된 PDF 처리 과정
            simulatePDFProcessing(examDate, examType, progressFill, processingMessage)
                .then(() => {
                    // 시험 일자 저장
                    if (!examDates.includes(examDate)) {
                        examDates.push(examDate);
                        localStorage.setItem('examDates', JSON.stringify(examDates));
                    }

                    alert(`시험문제가 성공적으로 생성되었습니다!\n시험 일자: ${examDate}\n시험 유형: ${examType}\n생성된 문제 수: 10개\n\n문제지: ${uploadedFiles.questionPDF.name}\n정답지: ${uploadedFiles.answerPDF.name}`);
                    
                    // 입력 필드 초기화
                    document.getElementById('examDate').value = '';
                    document.getElementById('examType').value = '';
                    
                    // 처리 상태 숨기기
                    setTimeout(() => {
                        processingStatus.style.display = 'none';
                    }, 2000);
                    
                    // 문제 목록 새로고침
                    displayQuestions();
                });
        }

        // PDF 처리 시뮬레이션
        async function simulatePDFProcessing(examDate, examType, progressFill, processingMessage) {
            const steps = [
                '문제지 PDF 분석 중...',
                '정답지 PDF 분석 중...',
                '문제와 정답 매칭 중...',
                '텍스트 추출 중...',
                '이미지 추출 중...',
                '문제 패턴 인식 중...',
                '보기 생성 중...',
                '정답 분석 중...',
                '문제 검증 중...',
                '완료!'
            ];

            // 정답지에서 정답번호 추출 시뮬레이션
            let answerNumbers = [];
            try {
                // 정답지 PDF에서 정답번호 추출 시도
                answerNumbers = simulateAnswerExtraction();
                if (answerNumbers.length === 0) {
                    // 정답번호를 추출할 수 없는 경우
                    setTimeout(() => {
                        alert('⚠️ 정답지에서 정답번호를 자동으로 추출할 수 없습니다.\n\n정답번호를 수동으로 입력해주시거나, 관리자에게 문의해주세요.');
                    }, 1000);
                }
            } catch (error) {
                console.log('정답번호 추출 실패:', error);
                setTimeout(() => {
                    alert('⚠️ 정답지 분석 중 오류가 발생했습니다.\n\n정답번호를 수동으로 입력해주시거나, 관리자에게 문의해주세요.');
                }, 1000);
            }

            for (let i = 0; i < steps.length; i++) {
                processingMessage.textContent = steps[i];
                progressFill.style.width = `${((i + 1) / steps.length) * 100}%`;
                
                // 각 단계별로 잠시 대기
                await new Promise(resolve => setTimeout(resolve, 600));
            }

            // 업로드된 파일을 기준으로 한 시험문제 생성
            const generatedQuestions = [
                {
                    id: Date.now() + 1,
                    question: `${examDate} 기출문제 - 고대 사회의 특징에 대한 설명으로 옳은 것은?`,
                    options: [
                        "청동기 문화가 발달하여 농경 사회가 정착되었다.",
                        "철기 문화가 도입되어 국가 체제가 완성되었다.",
                        "불교가 전래되어 사상적 통일이 이루어졌다.",
                        "유교가 국교로 채택되어 교육 제도가 확립되었다."
                    ],
                    answer: answerNumbers.length > 0 ? answerNumbers[0] : 1, // 추출된 정답번호 사용
                    examDate: examDate,
                    examType: examType,
                    score: 1,
                    explanation: "고대 사회는 청동기 문화가 발달하면서 농경 사회로 정착되었습니다. 청동기는 농기구 제작에 사용되어 농업 생산성을 크게 향상시켰고, 이는 정착 생활과 계급 사회의 출현을 가져왔습니다.",
                    createdAt: new Date().toISOString(),
                    autoGenerated: true,
                    image: null,
                    imageMissing: false,
                    sourceFiles: {
                        questionPDF: uploadedFiles.questionPDF.name,
                        answerPDF: uploadedFiles.answerPDF.name
                    }
                },
                {
                    id: Date.now() + 2,
                    question: `${examDate} 기출문제 - 삼국 시대의 정치 제도에 대한 설명으로 옳은 것은?`,
                    options: [
                        "고구려는 5부족 연맹체를 기반으로 하였다.",
                        "백제는 6부족 연맹체를 기반으로 하였다.",
                        "신라는 8부족 연맹체를 기반으로 하였다.",
                        "가야는 12부족 연맹체를 기반으로 하였다."
                    ],
                    answer: answerNumbers.length > 1 ? answerNumbers[1] : 2, // 추출된 정답번호 사용
                    examDate: examDate,
                    examType: examType,
                    score: 2,
                    explanation: "백제는 6부족 연맹체를 기반으로 하였습니다. 백제는 초기에는 마한의 54개 소국 중 하나였으나, 점차 주변 소국들을 통합하여 6부족 연맹체를 형성하고 중앙집권적 왕권을 확립하였습니다.",
                    createdAt: new Date().toISOString(),
                    autoGenerated: true,
                    image: null,
                    imageMissing: false,
                    sourceFiles: {
                        questionPDF: uploadedFiles.questionPDF.name,
                        answerPDF: uploadedFiles.answerPDF.name
                    }
                },
                {
                    id: Date.now() + 3,
                    question: `${examDate} 기출문제 - 고려 시대의 문화에 대한 설명으로 옳은 것은?`,
                    options: [
                        "초조대장경이 완성되어 불교 문화가 융성하였다.",
                        "훈민정음이 창제되어 한글 문화가 시작되었다.",
                        "동국통감이 편찬되어 역사 인식이 확립되었다.",
                        "경국대전이 완성되어 법전 체계가 정비되었다."
                    ],
                    answer: answerNumbers.length > 2 ? answerNumbers[2] : 3, // 추출된 정답번호 사용
                    examDate: examDate,
                    examType: examType,
                    score: 3,
                    explanation: "동국통감은 고려 시대에 편찬된 역사서로, 중국의 사마광이 편찬한 자치통감을 모범으로 하여 고구려, 백제, 신라의 역사를 통합하여 편찬한 통사입니다. 이는 고려의 역사 인식과 민족 의식을 보여주는 중요한 문화유산입니다.",
                    createdAt: new Date().toISOString(),
                    autoGenerated: true,
                    image: null,
                    imageMissing: true,
                    sourceFiles: {
                        questionPDF: uploadedFiles.questionPDF.name,
                        answerPDF: uploadedFiles.answerPDF.name
                    }
                },
                {
                    id: Date.now() + 4,
                    question: `${examDate} 기출문제 - 조선 시대의 경제 정책에 대한 설명으로 옳은 것은?`,
                    options: [
                        "대동법이 실시되어 조세 제도가 개편되었다.",
                        "공법이 실시되어 토지 제도가 개편되었다.",
                        "균역법이 실시되어 군역 제도가 개편되었다.",
                        "호조법이 실시되어 재정 제도가 개편되었다."
                    ],
                    answer: answerNumbers.length > 3 ? answerNumbers[3] : 4, // 추출된 정답번호 사용
                    examDate: examDate,
                    examType: examType,
                    score: 1,
                    createdAt: new Date().toISOString(),
                    autoGenerated: true,
                    image: null,
                    imageMissing: false,
                    sourceFiles: {
                        questionPDF: uploadedFiles.questionPDF.name,
                        answerPDF: uploadedFiles.answerPDF.name
                    }
                },
                {
                    id: Date.now() + 5,
                    question: `${examDate} 기출문제 - 근대 사회의 변화에 대한 설명으로 옳은 것은?`,
                    options: [
                        "개항 이후 서양 문물이 도입되어 생활이 변화하였다.",
                        "갑오개혁 이후 전통 문화가 부활하였다.",
                        "을사조약 이후 독립 운동이 소멸하였다.",
                        "한일합방 이후 민족 문화가 발전하였다."
                    ],
                    answer: answerNumbers.length > 4 ? answerNumbers[4] : 1, // 추출된 정답번호 사용
                    examDate: examDate,
                    examType: examType,
                    score: 2,
                    createdAt: new Date().toISOString(),
                    autoGenerated: true,
                    image: null,
                    imageMissing: false,
                    sourceFiles: {
                        questionPDF: uploadedFiles.questionPDF.name,
                        answerPDF: uploadedFiles.answerPDF.name
                    }
                },
                {
                    id: Date.now() + 6,
                    question: `${examDate} 기출문제 - 일제 강점기의 독립 운동에 대한 설명으로 옳은 것은?`,
                    options: [
                        "3·1운동은 비폭력 평화 운동이었다.",
                        "의열단은 외교적 독립 운동을 전개하였다.",
                        "대한민국 임시정부는 상해에서만 활동하였다.",
                        "광복군은 국내에서만 활동하였다."
                    ],
                    answer: answerNumbers.length > 5 ? answerNumbers[5] : 4, // 추출된 정답번호 사용
                    examDate: examDate,
                    examType: examType,
                    score: 3,
                    createdAt: new Date().toISOString(),
                    autoGenerated: true,
                    image: null,
                    imageMissing: false,
                    sourceFiles: {
                        questionPDF: uploadedFiles.questionPDF.name,
                        answerPDF: uploadedFiles.answerPDF.name
                    }
                },
                {
                    id: Date.now() + 7,
                    question: `${examDate} 기출문제 - 대한민국 정부 수립 과정에 대한 설명으로 옳은 것은?`,
                    options: [
                        "미군정은 3년간 한국을 통치하였다.",
                        "유엔은 한국의 독립을 승인하지 않았다.",
                        "대한민국 정부는 1948년 8월 15일에 수립되었다.",
                        "북한은 남한보다 먼저 정부를 수립하였다."
                    ],
                    answer: answerNumbers.length > 6 ? answerNumbers[6] : 3, // 추출된 정답번호 사용
                    examDate: examDate,
                    examType: examType,
                    score: 1,
                    createdAt: new Date().toISOString(),
                    autoGenerated: true,
                    image: null,
                    imageMissing: false,
                    sourceFiles: {
                        questionPDF: uploadedFiles.questionPDF.name,
                        answerPDF: uploadedFiles.answerPDF.name
                    }
                },
                {
                    id: Date.now() + 8,
                    question: `${examDate} 기출문제 - 6·25 전쟁에 대한 설명으로 옳은 것은?`,
                    options: [
                        "전쟁은 1950년 6월 25일에 시작되었다.",
                        "중국은 전쟁에 참전하지 않았다.",
                        "유엔군은 전쟁에 참전하지 않았다.",
                        "전쟁은 1년 만에 종료되었다."
                    ],
                    answer: answerNumbers.length > 7 ? answerNumbers[7] : 1, // 추출된 정답번호 사용
                    examDate: examDate,
                    examType: examType,
                    score: 2,
                    createdAt: new Date().toISOString(),
                    autoGenerated: true,
                    image: null,
                    imageMissing: true,
                    sourceFiles: {
                        questionPDF: uploadedFiles.questionPDF.name,
                        answerPDF: uploadedFiles.answerPDF.name
                    }
                },
                {
                    id: Date.now() + 9,
                    question: `${examDate} 기출문제 - 경제 개발 과정에 대한 설명으로 옳은 것은?`,
                    options: [
                        "1차 경제개발 5개년 계획은 1962년부터 시작되었다.",
                        "새마을운동은 도시 개발 운동이었다.",
                        "중화학공업은 1970년대에 시작되었다.",
                        "수출 주도 경제는 1980년대에 시작되었다."
                    ],
                    answer: answerNumbers.length > 8 ? answerNumbers[8] : 1, // 추출된 정답번호 사용
                    examDate: examDate,
                    examType: examType,
                    score: 3,
                    createdAt: new Date().toISOString(),
                    autoGenerated: true,
                    image: null,
                    imageMissing: false,
                    sourceFiles: {
                        questionPDF: uploadedFiles.questionPDF.name,
                        answerPDF: uploadedFiles.answerPDF.name
                    }
                },
                {
                    id: Date.now() + 10,
                    question: `${examDate} 기출문제 - 민주화 과정에 대한 설명으로 옳은 것은?`,
                    options: [
                        "4·19 혁명은 1960년에 발생하였다.",
                        "5·18 민주화운동은 1980년에 발생하였다.",
                        "6월 민주항쟁은 1987년에 발생하였다.",
                        "모든 민주화 운동은 성공하였다."
                    ],
                    answer: answerNumbers.length > 9 ? answerNumbers[9] : 3, // 추출된 정답번호 사용
                    examDate: examDate,
                    examType: examType,
                    score: 2,
                    createdAt: new Date().toISOString(),
                    autoGenerated: true,
                    image: null,
                    imageMissing: false,
                    sourceFiles: {
                        questionPDF: uploadedFiles.questionPDF.name,
                        answerPDF: uploadedFiles.answerPDF.name
                    }
                }
            ];

            // 자동 생성된 문제들을 저장
            questions = [...questions, ...generatedQuestions];
            localStorage.setItem('koreanHistoryQuestions', JSON.stringify(questions));
        }

        // 정답지에서 정답번호 추출 시뮬레이션
        function simulateAnswerExtraction() {
            // 실제로는 PDF에서 정답번호를 추출하는 AI/OCR 로직이 들어갈 자리
            // 현재는 시뮬레이션을 위해 랜덤하게 정답번호를 생성하거나 실패를 시뮬레이션
            
            // 정답 분석 상태 업데이트
            updateAnswerAnalysisStatus('분석 중...', '분석 중...', '분석 중...');
            
            // 70% 확률로 정답번호 추출 성공, 30% 확률로 실패
            if (Math.random() < 0.7) {
                // 정답번호 추출 성공 시뮬레이션
                const answers = [1, 2, 3, 4, 1, 4, 3, 2, 3, 2]; // 10개 문제의 정답번호
                updateAnswerAnalysisStatus('✅ 성공', answers.length + '개', '완료');
                return answers;
            } else {
                // 정답번호 추출 실패 시뮬레이션
                updateAnswerAnalysisStatus('❌ 실패', '0개', '실패');
                return [];
            }
        }

        // 정답 분석 상태 업데이트
        function updateAnswerAnalysisStatus(extractionStatus, answerCount, analysisStatus) {
            const extractionStatusElement = document.getElementById('answerExtractionStatus');
            const answerCountElement = document.getElementById('extractedAnswerCount');
            const analysisStatusElement = document.getElementById('analysisStatus');
            
            if (extractionStatusElement) {
                extractionStatusElement.textContent = extractionStatus;
                extractionStatusElement.style.color = extractionStatus.includes('성공') ? '#28a745' : 
                                                   extractionStatus.includes('실패') ? '#dc3545' : '#666';
            }
            
            if (answerCountElement) {
                answerCountElement.textContent = answerCount;
                answerCountElement.style.color = answerCount === '0개' ? '#dc3545' : '#28a745';
            }
            
            if (analysisStatusElement) {
                analysisStatusElement.textContent = analysisStatus;
                analysisStatusElement.style.color = analysisStatus === '완료' ? '#28a745' : 
                                                 analysisStatus === '실패' ? '#dc3545' : '#666';
            }
        }

        // 문제 등록
        function addQuestion() {
            const questionText = document.getElementById('questionText').value;
            const option1 = document.getElementById('option1').value;
            const option2 = document.getElementById('option2').value;
            const option3 = document.getElementById('option3').value;
            const option4 = document.getElementById('option4').value;
            const correctAnswer = document.getElementById('correctAnswer').value;
            const examDate = document.getElementById('examDateInput').value;
            const examType = document.getElementById('examTypeInput').value;
            const questionScore = document.getElementById('questionScore').value;
            const questionExplanation = document.getElementById('questionExplanation').value;
            const imageFile = document.getElementById('questionImage').files[0];

            if (!questionText || !option1 || !option2 || !option3 || !option4 || !correctAnswer || !examDate || !examType) {
                alert('모든 필드를 입력해주세요.');
                return;
            }

            // 이미지 처리
            let imageUrl = null;
            let imageMissing = false;
            if (imageFile) {
                imageUrl = URL.createObjectURL(imageFile);
            } else {
                imageMissing = true;
            }

            const question = {
                id: Date.now(),
                question: questionText,
                options: [option1, option2, option3, option4],
                answer: parseInt(correctAnswer),
                examDate: examDate,
                examType: examType,
                score: parseInt(questionScore),
                explanation: questionExplanation,
                createdAt: new Date().toISOString(),
                autoGenerated: false,
                image: imageUrl,
                imageMissing: imageMissing
            };

            questions.push(question);
            localStorage.setItem('koreanHistoryQuestions', JSON.stringify(questions));

            // 시험 일자 저장
            if (!examDates.includes(examDate)) {
                examDates.push(examDate);
                localStorage.setItem('examDates', JSON.stringify(examDates));
            }

            alert('문제가 성공적으로 등록되었습니다.');
            clearForm();
            displayQuestions();
        }

        // 폼 초기화
        function clearForm() {
            document.getElementById('questionText').value = '';
            document.getElementById('option1').value = '';
            document.getElementById('option2').value = '';
            document.getElementById('option3').value = '';
            document.getElementById('option4').value = '';
            document.getElementById('correctAnswer').value = '';
            document.getElementById('examDateInput').value = '';
            document.getElementById('examTypeInput').value = '';
            document.getElementById('questionScore').value = '1';
            document.getElementById('questionExplanation').value = '';
            document.getElementById('questionImage').value = '';
        }

        // 문제 삭제
        function deleteQuestion(id) {
            if (confirm('정말로 이 문제를 삭제하시겠습니까?')) {
                questions = questions.filter(q => q.id !== id);
                localStorage.setItem('koreanHistoryQuestions', JSON.stringify(questions));
                displayQuestions();
                alert('문제가 삭제되었습니다.');
            }
        }

        // 전체 문제 선택
        function selectAllQuestions() {
            const checkboxes = document.querySelectorAll('.question-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
            });
            updateSelectedCount();
        }

        // 전체 문제 선택 해제
        function deselectAllQuestions() {
            const checkboxes = document.querySelectorAll('.question-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            updateSelectedCount();
        }

        // 선택된 문제 삭제
        function deleteSelectedQuestions() {
            const checkboxes = document.querySelectorAll('.question-checkbox:checked');
            if (checkboxes.length === 0) {
                alert('삭제할 문제를 선택해주세요.');
                return;
            }

            if (confirm(`선택된 ${checkboxes.length}개의 문제를 삭제하시겠습니까?`)) {
                const selectedIds = Array.from(checkboxes).map(checkbox => 
                    parseInt(checkbox.id.replace('checkbox_', ''))
                );
                
                questions = questions.filter(q => !selectedIds.includes(q.id));
                localStorage.setItem('koreanHistoryQuestions', JSON.stringify(questions));
                displayQuestions();
                alert(`${checkboxes.length}개의 문제가 삭제되었습니다.`);
            }
        }

        // 시험일자별 일괄 삭제
        function deleteQuestionsByDate() {
            const selectedDate = document.getElementById('examDateSelect').value;
            if (!selectedDate) {
                alert('삭제할 시험일자를 선택해주세요.');
                return;
            }

            const questionsToDelete = questions.filter(q => q.examDate === selectedDate);
            if (questionsToDelete.length === 0) {
                alert('해당 시험일자에 등록된 문제가 없습니다.');
                return;
            }

            if (confirm(`"${selectedDate}" 시험일자의 ${questionsToDelete.length}개 문제를 모두 삭제하시겠습니까?`)) {
                questions = questions.filter(q => q.examDate !== selectedDate);
                localStorage.setItem('koreanHistoryQuestions', JSON.stringify(questions));
                
                // 시험일자 목록에서도 제거
                examDates = examDates.filter(date => date !== selectedDate);
                localStorage.setItem('examDates', JSON.stringify(examDates));
                
                displayQuestions();
                alert(`"${selectedDate}" 시험일자의 ${questionsToDelete.length}개 문제가 삭제되었습니다.`);
            }
        }

        // 선택된 문제 수 업데이트
        function updateSelectedCount() {
            const checkboxes = document.querySelectorAll('.question-checkbox:checked');
            const selectedCount = document.getElementById('selectedCount');
            selectedCount.textContent = `선택된 문제: ${checkboxes.length}개`;
        }

        // 시험일자 선택 옵션 업데이트
        function updateExamDateOptions() {
            const examDateSelect = document.getElementById('examDateSelect');
            if (!examDateSelect) return;
            
            // 기존 옵션 제거 (첫 번째 "시험일자 선택" 옵션 제외)
            while (examDateSelect.children.length > 1) {
                examDateSelect.removeChild(examDateSelect.lastChild);
            }
            
            // 시험일자별로 그룹화된 문제 수 계산
            const dateCounts = {};
            questions.forEach(q => {
                dateCounts[q.examDate] = (dateCounts[q.examDate] || 0) + 1;
            });
            
            // 시험일자 옵션 추가
            Object.keys(dateCounts).sort().forEach(date => {
                const option = document.createElement('option');
                option.value = date;
                option.textContent = `${date} (${dateCounts[date]}개 문제)`;
                examDateSelect.appendChild(option);
            });
        }

        // 문제 목록 표시
        function displayQuestions() {
            const container = document.getElementById('questionsList');
            
            if (questions.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">등록된 문제가 없습니다.</p>';
                return;
            }

            // 시험 일자별로 그룹화
            const groupedQuestions = {};
            questions.forEach(q => {
                if (!groupedQuestions[q.examDate]) {
                    groupedQuestions[q.examDate] = [];
                }
                groupedQuestions[q.examDate].push(q);
            });

            let html = '';
            Object.keys(groupedQuestions).forEach(date => {
                html += `<h3 style="color: #ff6b6b; margin-top: 20px;">📅 ${date}</h3>`;
                groupedQuestions[date].forEach(q => {
                    html += `
                        <div class="question-item ${q.autoGenerated ? 'auto-generated' : ''}">
                            <div class="question-header">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="checkbox_${q.id}" class="question-checkbox" onchange="updateSelectedCount()">
                                    <span class="question-number">문제 ${q.id}</span>
                                </div>
                                <button class="btn btn-danger" onclick="deleteQuestion(${q.id})">삭제</button>
                            </div>
                            <div class="question-text">
                                <span class="question-score">[${q.score}점]</span> ${q.question}
                            </div>
                            ${q.image ? `<img src="${q.image}" alt="문제 이미지" class="question-image">` : ''}
                            ${q.imageMissing ? '<div class="image-missing">이 문제는 이미지가 누락되어 있습니다.</div>' : ''}
                            <ul class="options-list">
                                ${q.options.map((option, index) => 
                                    `<li>${index + 1}. ${option} ${index + 1 === q.answer ? '<span class="correct-answer">(정답)</span>' : ''}</li>`
                                ).join('')}
                            </ul>
                            ${q.sourceFiles ? `
                                <div style="margin-top: 10px; font-size: 0.9em; color: #666;">
                                    📁 출처: ${q.sourceFiles.questionPDF}, ${q.sourceFiles.answerPDF}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
            });

            container.innerHTML = html;
            
            // 시험일자 선택 옵션 업데이트
            updateExamDateOptions();
        }

        // 드래그 앤 드롭 기능
        const questionUploadArea = document.getElementById('questionUploadArea');
        const answerUploadArea = document.getElementById('answerUploadArea');
        
        [questionUploadArea, answerUploadArea].forEach(area => {
            area.addEventListener('dragover', (e) => {
                e.preventDefault();
                area.style.borderColor = '#ff6b6b';
                area.style.background = '#fff5f5';
            });

            area.addEventListener('dragleave', (e) => {
                e.preventDefault();
                area.style.borderColor = '#ddd';
                area.style.background = '#fafafa';
            });

            area.addEventListener('drop', (e) => {
                e.preventDefault();
                area.style.borderColor = '#ddd';
                area.style.background = '#fafafa';
                
                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].type === 'application/pdf') {
                    const fileType = area.id === 'questionUploadArea' ? 'questionPDF' : 'answerPDF';
                    const fileInput = document.getElementById(fileType === 'questionPDF' ? 'questionPDF' : 'answerPDF');
                    fileInput.files = files;
                    handleFileUpload({ target: fileInput }, fileType);
                } else {
                    alert('PDF 파일만 업로드 가능합니다.');
                }
            });
        });
    </script>
</body>
</html>
