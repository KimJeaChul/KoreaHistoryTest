<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì í˜ì´ì§€ - í•œêµ­ì‚¬ ê¸°ì¶œë¬¸ì œ ì‹œìŠ¤í…œ</title>
    <style>
        body {
            font-family: 'Malgun Gothic', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .header {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .section h2 {
            color: #333;
            border-bottom: 3px solid #ff6b6b;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        input[type="text"], input[type="file"], textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }
        input[type="text"]:focus, textarea:focus, select:focus {
            border-color: #ff6b6b;
            outline: none;
        }
        .btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .btn-secondary {
            background: linear-gradient(45deg, #6c757d, #495057);
        }
        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #c82333);
        }
        .btn-success {
            background: linear-gradient(45deg, #28a745, #20c997);
        }
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .question-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .question-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #ff6b6b;
        }
        .bulk-management-tools {
            border: 1px solid #dee2e6;
        }
        .bulk-management-tools h4 {
            margin-bottom: 15px;
        }
        .question-number {
            font-weight: bold;
            color: #ff6b6b;
            font-size: 1.1em;
        }
        .question-text {
            margin-bottom: 15px;
            line-height: 1.6;
        }
        .question-score {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            margin-right: 8px;
        }
        .question-image {
            max-width: 200px;
            height: auto;
            border-radius: 8px;
            margin: 10px 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        .image-missing {
            background: #fff3cd;
            border: 2px dashed #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            text-align: center;
            color: #856404;
            font-weight: bold;
        }
        .image-missing::before {
            content: "ğŸ–¼ï¸ ì´ë¯¸ì§€ ëˆ„ë½";
            display: block;
            margin-bottom: 5px;
        }
        .options-list {
            list-style: none;
            padding: 0;
        }
        .options-list li {
            padding: 5px 0;
            color: #666;
        }
        .correct-answer {
            color: #28a745;
            font-weight: bold;
        }
        .nav-back {
            text-align: center;
            margin-bottom: 20px;
        }
        .nav-back a {
            color: #666;
            text-decoration: none;
            font-size: 1.1em;
        }
        .nav-back a:hover {
            color: #ff6b6b;
        }
        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            background: #fafafa;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        .upload-area:hover {
            border-color: #ff6b6b;
            background: #fff5f5;
        }
        .upload-area.uploaded {
            border-color: #28a745;
            background: #e8f5e8;
        }
        .upload-area.uploaded::after {
            content: "âœ… ì—…ë¡œë“œ ì™„ë£Œ";
            display: block;
            color: #28a745;
            font-weight: bold;
            margin-top: 10px;
        }
        .file-input {
            display: none;
        }
        .file-label {
            cursor: pointer;
            color: #ff6b6b;
            font-weight: bold;
        }
        .upload-status {
            background: #e8f5e8;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            display: none;
        }
        .upload-status h3 {
            color: #28a745;
            margin: 0 0 10px 0;
        }
        .file-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .file-info h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .file-details {
            color: #666;
            font-size: 0.9em;
        }
        .processing-status {
            background: #e8f5e8;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            display: none;
        }
        .processing-status h3 {
            color: #28a745;
            margin: 0 0 10px 0;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #28a745, #20c997);
            width: 0%;
            transition: width 0.3s ease;
        }
        .auto-generated {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            color: #856404;
        }
        .auto-generated::before {
            content: "ğŸ¤– ìë™ ìƒì„±ëœ ë¬¸ì œ";
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }
        .upload-buttons {
            text-align: center;
            margin-top: 20px;
        }
        .upload-buttons .btn {
            margin: 0 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav-back">
            <a href="Index.html">â† ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>
        
        <div class="header">
            <h1>ê´€ë¦¬ì í˜ì´ì§€</h1>
            <p>í•œêµ­ì‚¬ ê¸°ì¶œë¬¸ì œ ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
        </div>

        <!-- PDF ì—…ë¡œë“œ ì„¹ì…˜ -->
        <div class="section">
            <h2>ğŸ“„ PDF íŒŒì¼ ì—…ë¡œë“œ (ìë™ ë¬¸ì œ ìƒì„±)</h2>
            
            <!-- ë¬¸ì œì§€ ì—…ë¡œë“œ -->
            <div class="upload-area" id="questionUploadArea">
                <h3>â‘  ë¬¸ì œì§€</h3>
                <p>ë¬¸ì œì§€ PDF íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
                <input type="file" id="questionPDF" class="file-input" accept=".pdf">
                <label for="questionPDF" class="file-label">ë¬¸ì œì§€ ì„ íƒ</label>
            </div>

            <!-- ì •ë‹µì§€ ì—…ë¡œë“œ -->
            <div class="upload-area" id="answerUploadArea">
                <h3>â‘¡ ì •ë‹µì§€</h3>
                <p>ì •ë‹µì§€ PDF íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
                <input type="file" id="answerPDF" class="file-input" accept=".pdf">
                <label for="answerPDF" class="file-label">ì •ë‹µì§€ ì„ íƒ</label>
            </div>

            <!-- ì—…ë¡œë“œ ìƒíƒœ í‘œì‹œ -->
            <div class="upload-status" id="uploadStatus">
                <h3>ğŸ“ ì—…ë¡œë“œ ìƒíƒœ</h3>
                <div id="fileInfoContainer">
                    <!-- íŒŒì¼ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <div class="form-group">
                <label for="examDate">ì‹œí—˜ ì¼ì:</label>
                <input type="text" id="examDate" placeholder="ì˜ˆ: 2024ë…„ 3ì›” 9ì¼">
            </div>
            <div class="form-group">
                <label for="examType">ì‹œí—˜ ìœ í˜•:</label>
                <select id="examType">
                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="ì¼ë°˜">ì¼ë°˜</option>
                    <option value="ì‹¬í™”">ì‹¬í™”</option>
                </select>
            </div>
            
            <div class="upload-buttons">
                <button class="btn btn-success" id="generateBtn" onclick="generateQuestions()" disabled>
                    ğŸ“ ì‹œí—˜ë¬¸ì œ ìƒì„±í•˜ê¸°
                </button>
                <button class="btn btn-secondary" onclick="resetUploads()">
                    ğŸ”„ ì—…ë¡œë“œ ì´ˆê¸°í™”
                </button>
            </div>
            
            <!-- ì²˜ë¦¬ ìƒíƒœ í‘œì‹œ -->
            <div class="processing-status" id="processingStatus">
                <h3>ğŸ“Š ë¬¸ì œ ìƒì„± ì¤‘...</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p id="processingMessage">PDF íŒŒì¼ì„ ë¶„ì„í•˜ê³  ë¬¸ì œë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
            </div>
        </div>

        <!-- ë¬¸ì œ ë“±ë¡ ì„¹ì…˜ -->
        <div class="section">
            <h2>âœï¸ ìˆ˜ë™ ë¬¸ì œ ë“±ë¡</h2>
            <div class="form-group">
                <label for="questionText">ë¬¸ì œ ë‚´ìš©:</label>
                <textarea id="questionText" rows="4" placeholder="ë¬¸ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>
            <div class="form-group">
                <label for="questionImage">ë¬¸ì œ ì´ë¯¸ì§€ (ì„ íƒì‚¬í•­):</label>
                <input type="file" id="questionImage" accept="image/*">
            </div>
            <div class="form-group">
                <label for="option1">ë³´ê¸° 1:</label>
                <input type="text" id="option1" placeholder="ì²« ë²ˆì§¸ ë³´ê¸°">
            </div>
            <div class="form-group">
                <label for="option2">ë³´ê¸° 2:</label>
                <input type="text" id="option2" placeholder="ë‘ ë²ˆì§¸ ë³´ê¸°">
            </div>
            <div class="form-group">
                <label for="option3">ë³´ê¸° 3:</label>
                <input type="text" id="option3" placeholder="ì„¸ ë²ˆì§¸ ë³´ê¸°">
            </div>
            <div class="form-group">
                <label for="option4">ë³´ê¸° 4:</label>
                <input type="text" id="option4" placeholder="ë„¤ ë²ˆì§¸ ë³´ê¸°">
            </div>
            <div class="form-group">
                <label for="correctAnswer">ì •ë‹µ:</label>
                <select id="correctAnswer">
                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="1">1ë²ˆ</option>
                    <option value="2">2ë²ˆ</option>
                    <option value="3">3ë²ˆ</option>
                    <option value="4">4ë²ˆ</option>
                </select>
            </div>
            <div class="form-group">
                <label for="examDateInput">ì‹œí—˜ ì¼ì:</label>
                <input type="text" id="examDateInput" placeholder="ì˜ˆ: 2024ë…„ 3ì›” 9ì¼">
            </div>
            <div class="form-group">
                <label for="examTypeInput">ì‹œí—˜ ìœ í˜•:</label>
                <select id="examTypeInput">
                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="ì¼ë°˜">ì¼ë°˜</option>
                    <option value="ì‹¬í™”">ì‹¬í™”</option>
                </select>
            </div>
            <div class="form-group">
                <label for="questionScore">ë¬¸ì œ ì ìˆ˜:</label>
                <select id="questionScore">
                    <option value="1">1ì </option>
                    <option value="2">2ì </option>
                    <option value="3">3ì </option>
                </select>
            </div>
            <div class="form-group">
                <label for="questionExplanation">ë¬¸ì œ í•´ì„¤ (ì„ íƒì‚¬í•­):</label>
                <textarea id="questionExplanation" rows="4" placeholder="ë¬¸ì œì— ëŒ€í•œ í•´ì„¤ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>
            <button class="btn" onclick="addQuestion()">ë¬¸ì œ ë“±ë¡</button>
        </div>

        <!-- ë¬¸ì œ ê´€ë¦¬ ì„¹ì…˜ -->
        <div class="section">
            <h2>ğŸ“‹ ë“±ë¡ëœ ë¬¸ì œ ê´€ë¦¬</h2>
            
            <!-- ì¼ê´„ ê´€ë¦¬ ë„êµ¬ -->
            <div class="bulk-management-tools" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                <h4 style="margin-top: 0; color: #495057;">ğŸ”§ ì¼ê´„ ê´€ë¦¬ ë„êµ¬</h4>
                
                <!-- ì‹œí—˜ì¼ìë³„ ì¼ê´„ ì‚­ì œ -->
                <div style="margin-bottom: 15px;">
                    <label for="examDateSelect">ì‹œí—˜ì¼ìë³„ ì¼ê´„ ì‚­ì œ:</label>
                    <select id="examDateSelect" style="width: auto; display: inline-block; margin: 0 10px;">
                        <option value="">ì‹œí—˜ì¼ì ì„ íƒ</option>
                    </select>
                    <button class="btn btn-danger" onclick="deleteQuestionsByDate()">ì„ íƒëœ ì‹œí—˜ì¼ì ë¬¸ì œ ì¼ê´„ ì‚­ì œ</button>
                </div>
                
                <!-- ì¼ê´„ ì„ íƒ ë„êµ¬ -->
                <div style="margin-bottom: 15px;">
                    <button class="btn btn-secondary" onclick="selectAllQuestions()">ì „ì²´ ì„ íƒ</button>
                    <button class="btn btn-secondary" onclick="deselectAllQuestions()">ì „ì²´ í•´ì œ</button>
                    <button class="btn btn-danger" onclick="deleteSelectedQuestions()">ì„ íƒëœ ë¬¸ì œ ì‚­ì œ</button>
                </div>
                
                <!-- ì„ íƒëœ ë¬¸ì œ ìˆ˜ í‘œì‹œ -->
                <div id="selectedCount" style="color: #666; font-size: 0.9em;">
                    ì„ íƒëœ ë¬¸ì œ: 0ê°œ
                </div>
            </div>
            
            <div id="questionsList">
                <!-- ë“±ë¡ëœ ë¬¸ì œë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <script>
        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¬¸ì œ ë°ì´í„° ë¡œë“œ
        let questions = JSON.parse(localStorage.getItem('koreanHistoryQuestions')) || [];
        let examDates = JSON.parse(localStorage.getItem('examDates')) || [];
        
        // ì—…ë¡œë“œëœ íŒŒì¼ ì •ë³´
        let uploadedFiles = {
            questionPDF: null,
            answerPDF: null
        };

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¬¸ì œ ëª©ë¡ í‘œì‹œ
        window.onload = function() {
            displayQuestions();
            setupFileUploads();
        };

        // íŒŒì¼ ì—…ë¡œë“œ ì„¤ì •
        function setupFileUploads() {
            const questionPDF = document.getElementById('questionPDF');
            const answerPDF = document.getElementById('answerPDF');

            questionPDF.addEventListener('change', (e) => handleFileUpload(e, 'questionPDF'));
            answerPDF.addEventListener('change', (e) => handleFileUpload(e, 'answerPDF'));
        }

        // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
        function handleFileUpload(event, fileType) {
            const file = event.target.files[0];
            if (file && file.type === 'application/pdf') {
                uploadedFiles[fileType] = {
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    lastModified: file.lastModified
                };
                
                // ì—…ë¡œë“œ ì˜ì—­ ìŠ¤íƒ€ì¼ ë³€ê²½
                const uploadArea = document.getElementById(fileType === 'questionPDF' ? 'questionUploadArea' : 'answerUploadArea');
                uploadArea.classList.add('uploaded');
                
                // ì—…ë¡œë“œ ìƒíƒœ í‘œì‹œ
                updateUploadStatus();
                
                // ì‹œí—˜ë¬¸ì œ ìƒì„± ë²„íŠ¼ í™œì„±í™” í™•ì¸
                checkGenerateButton();
            } else {
                alert('PDF íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                event.target.value = '';
            }
        }

        // ì—…ë¡œë“œ ìƒíƒœ í‘œì‹œ
        function updateUploadStatus() {
            const uploadStatus = document.getElementById('uploadStatus');
            const fileInfoContainer = document.getElementById('fileInfoContainer');
            
            let html = '';
            
            if (uploadedFiles.questionPDF) {
                html += `
                    <div class="file-info">
                        <h4>âœ… ë¬¸ì œì§€ ì—…ë¡œë“œ ì™„ë£Œ</h4>
                        <div class="file-details">
                            íŒŒì¼ëª…: ${uploadedFiles.questionPDF.name}<br>
                            í¬ê¸°: ${(uploadedFiles.questionPDF.size / 1024 / 1024).toFixed(2)} MB<br>
                            ì—…ë¡œë“œ ì‹œê°„: ${new Date(uploadedFiles.questionPDF.lastModified).toLocaleString()}
                        </div>
                    </div>
                `;
            }
            
            if (uploadedFiles.answerPDF) {
                html += `
                    <div class="file-info">
                        <h4>âœ… ì •ë‹µì§€ ì—…ë¡œë“œ ì™„ë£Œ</h4>
                        <div class="file-details">
                            íŒŒì¼ëª…: ${uploadedFiles.answerPDF.name}<br>
                            í¬ê¸°: ${(uploadedFiles.answerPDF.size / 1024 / 1024).toFixed(2)} MB<br>
                            ì—…ë¡œë“œ ì‹œê°„: ${new Date(uploadedFiles.answerPDF.lastModified).toLocaleString()}
                        </div>
                        <div class="answer-analysis-info" style="margin-top: 10px; padding: 10px; background: #e8f5e8; border-radius: 5px; border-left: 4px solid #28a745;">
                            <strong>ğŸ“Š ì •ë‹µì§€ ë¶„ì„ ì •ë³´:</strong><br>
                            â€¢ ì •ë‹µë²ˆí˜¸ ìë™ ì¶”ì¶œ: <span id="answerExtractionStatus">ëŒ€ê¸° ì¤‘...</span><br>
                            â€¢ ì¶”ì¶œëœ ì •ë‹µ ìˆ˜: <span id="extractedAnswerCount">-</span><br>
                            â€¢ ë¶„ì„ ìƒíƒœ: <span id="analysisStatus">ëŒ€ê¸° ì¤‘...</span>
                        </div>
                    </div>
                `;
            }
            
            fileInfoContainer.innerHTML = html;
            uploadStatus.style.display = 'block';
        }

        // ì‹œí—˜ë¬¸ì œ ìƒì„± ë²„íŠ¼ í™œì„±í™” í™•ì¸
        function checkGenerateButton() {
            const generateBtn = document.getElementById('generateBtn');
            if (uploadedFiles.questionPDF && uploadedFiles.answerPDF) {
                generateBtn.disabled = false;
                generateBtn.textContent = 'ğŸ“ ì‹œí—˜ë¬¸ì œ ìƒì„±í•˜ê¸° (ë¬¸ì œì§€ + ì •ë‹µì§€)';
            } else {
                generateBtn.disabled = true;
                generateBtn.textContent = 'ğŸ“ ì‹œí—˜ë¬¸ì œ ìƒì„±í•˜ê¸°';
            }
        }

        // ì—…ë¡œë“œ ì´ˆê¸°í™”
        function resetUploads() {
            uploadedFiles = {
                questionPDF: null,
                answerPDF: null
            };
            
            // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
            document.getElementById('questionPDF').value = '';
            document.getElementById('answerPDF').value = '';
            
            // ì—…ë¡œë“œ ì˜ì—­ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
            document.getElementById('questionUploadArea').classList.remove('uploaded');
            document.getElementById('answerUploadArea').classList.remove('uploaded');
            
            // ì—…ë¡œë“œ ìƒíƒœ ìˆ¨ê¸°ê¸°
            document.getElementById('uploadStatus').style.display = 'none';
            
            // ì‹œí—˜ë¬¸ì œ ìƒì„± ë²„íŠ¼ ë¹„í™œì„±í™”
            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = true;
            generateBtn.textContent = 'ğŸ“ ì‹œí—˜ë¬¸ì œ ìƒì„±í•˜ê¸°';
        }

        // ì‹œí—˜ë¬¸ì œ ìƒì„±
        function generateQuestions() {
            const examDate = document.getElementById('examDate').value;
            const examType = document.getElementById('examType').value;
            
            if (!examDate || !examType) {
                alert('ì‹œí—˜ ì¼ìì™€ ìœ í˜•ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (!uploadedFiles.questionPDF || !uploadedFiles.answerPDF) {
                alert('ë¬¸ì œì§€ì™€ ì •ë‹µì§€ë¥¼ ëª¨ë‘ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
                return;
            }

            // ì²˜ë¦¬ ìƒíƒœ í‘œì‹œ
            const processingStatus = document.getElementById('processingStatus');
            const progressFill = document.getElementById('progressFill');
            const processingMessage = document.getElementById('processingMessage');
            
            processingStatus.style.display = 'block';
            progressFill.style.width = '0%';

            // ì‹œë®¬ë ˆì´ì…˜ëœ PDF ì²˜ë¦¬ ê³¼ì •
            simulatePDFProcessing(examDate, examType, progressFill, processingMessage)
                .then(() => {
                    // ì‹œí—˜ ì¼ì ì €ì¥
                    if (!examDates.includes(examDate)) {
                        examDates.push(examDate);
                        localStorage.setItem('examDates', JSON.stringify(examDates));
                    }

                    alert(`ì‹œí—˜ë¬¸ì œê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!\nì‹œí—˜ ì¼ì: ${examDate}\nì‹œí—˜ ìœ í˜•: ${examType}\nìƒì„±ëœ ë¬¸ì œ ìˆ˜: 10ê°œ\n\në¬¸ì œì§€: ${uploadedFiles.questionPDF.name}\nì •ë‹µì§€: ${uploadedFiles.answerPDF.name}`);
                    
                    // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                    document.getElementById('examDate').value = '';
                    document.getElementById('examType').value = '';
                    
                    // ì²˜ë¦¬ ìƒíƒœ ìˆ¨ê¸°ê¸°
                    setTimeout(() => {
                        processingStatus.style.display = 'none';
                    }, 2000);
                    
                    // ë¬¸ì œ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    displayQuestions();
                });
        }

        // PDF ì²˜ë¦¬ ì‹œë®¬ë ˆì´ì…˜
        async function simulatePDFProcessing(examDate, examType, progressFill, processingMessage) {
            const steps = [
                'ë¬¸ì œì§€ PDF ë¶„ì„ ì¤‘...',
                'ì •ë‹µì§€ PDF ë¶„ì„ ì¤‘...',
                'ë¬¸ì œì™€ ì •ë‹µ ë§¤ì¹­ ì¤‘...',
                'í…ìŠ¤íŠ¸ ì¶”ì¶œ ì¤‘...',
                'ì´ë¯¸ì§€ ì¶”ì¶œ ì¤‘...',
                'ë¬¸ì œ íŒ¨í„´ ì¸ì‹ ì¤‘...',
                'ë³´ê¸° ìƒì„± ì¤‘...',
                'ì •ë‹µ ë¶„ì„ ì¤‘...',
                'ë¬¸ì œ ê²€ì¦ ì¤‘...',
                'ì™„ë£Œ!'
            ];

            // ì •ë‹µì§€ì—ì„œ ì •ë‹µë²ˆí˜¸ ì¶”ì¶œ ì‹œë®¬ë ˆì´ì…˜
            let answerNumbers = [];
            try {
                // ì •ë‹µì§€ PDFì—ì„œ ì •ë‹µë²ˆí˜¸ ì¶”ì¶œ ì‹œë„
                answerNumbers = simulateAnswerExtraction();
                if (answerNumbers.length === 0) {
                    // ì •ë‹µë²ˆí˜¸ë¥¼ ì¶”ì¶œí•  ìˆ˜ ì—†ëŠ” ê²½ìš°
                    setTimeout(() => {
                        alert('âš ï¸ ì •ë‹µì§€ì—ì„œ ì •ë‹µë²ˆí˜¸ë¥¼ ìë™ìœ¼ë¡œ ì¶”ì¶œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\nì •ë‹µë²ˆí˜¸ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì‹œê±°ë‚˜, ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.');
                    }, 1000);
                }
            } catch (error) {
                console.log('ì •ë‹µë²ˆí˜¸ ì¶”ì¶œ ì‹¤íŒ¨:', error);
                setTimeout(() => {
                    alert('âš ï¸ ì •ë‹µì§€ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\nì •ë‹µë²ˆí˜¸ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì‹œê±°ë‚˜, ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.');
                }, 1000);
            }

            for (let i = 0; i < steps.length; i++) {
                processingMessage.textContent = steps[i];
                progressFill.style.width = `${((i + 1) / steps.length) * 100}%`;
                
                // ê° ë‹¨ê³„ë³„ë¡œ ì ì‹œ ëŒ€ê¸°
                await new Promise(resolve => setTimeout(resolve, 600));
            }

            // ì—…ë¡œë“œëœ íŒŒì¼ì„ ê¸°ì¤€ìœ¼ë¡œ í•œ ì‹œí—˜ë¬¸ì œ ìƒì„±
            const generatedQuestions = [
                {
                    id: Date.now() + 1,
                    question: `${examDate} ê¸°ì¶œë¬¸ì œ - ê³ ëŒ€ ì‚¬íšŒì˜ íŠ¹ì§•ì— ëŒ€í•œ ì„¤ëª…ìœ¼ë¡œ ì˜³ì€ ê²ƒì€?`,
                    options: [
                        "ì²­ë™ê¸° ë¬¸í™”ê°€ ë°œë‹¬í•˜ì—¬ ë†ê²½ ì‚¬íšŒê°€ ì •ì°©ë˜ì—ˆë‹¤.",
                        "ì² ê¸° ë¬¸í™”ê°€ ë„ì…ë˜ì–´ êµ­ê°€ ì²´ì œê°€ ì™„ì„±ë˜ì—ˆë‹¤.",
                        "ë¶ˆêµê°€ ì „ë˜ë˜ì–´ ì‚¬ìƒì  í†µì¼ì´ ì´ë£¨ì–´ì¡Œë‹¤.",
                        "ìœ êµê°€ êµ­êµë¡œ ì±„íƒë˜ì–´ êµìœ¡ ì œë„ê°€ í™•ë¦½ë˜ì—ˆë‹¤."
                    ],
                    answer: answerNumbers.length > 0 ? answerNumbers[0] : 1, // ì¶”ì¶œëœ ì •ë‹µë²ˆí˜¸ ì‚¬ìš©
                    examDate: examDate,
                    examType: examType,
                    score: 1,
                    explanation: "ê³ ëŒ€ ì‚¬íšŒëŠ” ì²­ë™ê¸° ë¬¸í™”ê°€ ë°œë‹¬í•˜ë©´ì„œ ë†ê²½ ì‚¬íšŒë¡œ ì •ì°©ë˜ì—ˆìŠµë‹ˆë‹¤. ì²­ë™ê¸°ëŠ” ë†ê¸°êµ¬ ì œì‘ì— ì‚¬ìš©ë˜ì–´ ë†ì—… ìƒì‚°ì„±ì„ í¬ê²Œ í–¥ìƒì‹œì¼°ê³ , ì´ëŠ” ì •ì°© ìƒí™œê³¼ ê³„ê¸‰ ì‚¬íšŒì˜ ì¶œí˜„ì„ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.",
                    createdAt: new Date().toISOString(),
                    autoGenerated: true,
                    image: null,
                    imageMissing: false,
                    sourceFiles: {
                        questionPDF: uploadedFiles.questionPDF.name,
                        answerPDF: uploadedFiles.answerPDF.name
                    }
                },
                {
                    id: Date.now() + 2,
                    question: `${examDate} ê¸°ì¶œë¬¸ì œ - ì‚¼êµ­ ì‹œëŒ€ì˜ ì •ì¹˜ ì œë„ì— ëŒ€í•œ ì„¤ëª…ìœ¼ë¡œ ì˜³ì€ ê²ƒì€?`,
                    options: [
                        "ê³ êµ¬ë ¤ëŠ” 5ë¶€ì¡± ì—°ë§¹ì²´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ì˜€ë‹¤.",
                        "ë°±ì œëŠ” 6ë¶€ì¡± ì—°ë§¹ì²´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ì˜€ë‹¤.",
                        "ì‹ ë¼ëŠ” 8ë¶€ì¡± ì—°ë§¹ì²´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ì˜€ë‹¤.",
                        "ê°€ì•¼ëŠ” 12ë¶€ì¡± ì—°ë§¹ì²´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ì˜€ë‹¤."
                    ],
                    answer: answerNumbers.length > 1 ? answerNumbers[1] : 2, // ì¶”ì¶œëœ ì •ë‹µë²ˆí˜¸ ì‚¬ìš©
                    examDate: examDate,
                    examType: examType,
                    score: 2,
                    explanation: "ë°±ì œëŠ” 6ë¶€ì¡± ì—°ë§¹ì²´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ì˜€ìŠµë‹ˆë‹¤. ë°±ì œëŠ” ì´ˆê¸°ì—ëŠ” ë§ˆí•œì˜ 54ê°œ ì†Œêµ­ ì¤‘ í•˜ë‚˜ì˜€ìœ¼ë‚˜, ì ì°¨ ì£¼ë³€ ì†Œêµ­ë“¤ì„ í†µí•©í•˜ì—¬ 6ë¶€ì¡± ì—°ë§¹ì²´ë¥¼ í˜•ì„±í•˜ê³  ì¤‘ì•™ì§‘ê¶Œì  ì™•ê¶Œì„ í™•ë¦½í•˜ì˜€ìŠµë‹ˆë‹¤.",
                    createdAt: new Date().toISOString(),
                    autoGenerated: true,
                    image: null,
                    imageMissing: false,
                    sourceFiles: {
                        questionPDF: uploadedFiles.questionPDF.name,
                        answerPDF: uploadedFiles.answerPDF.name
                    }
                },
                {
                    id: Date.now() + 3,
                    question: `${examDate} ê¸°ì¶œë¬¸ì œ - ê³ ë ¤ ì‹œëŒ€ì˜ ë¬¸í™”ì— ëŒ€í•œ ì„¤ëª…ìœ¼ë¡œ ì˜³ì€ ê²ƒì€?`,
                    options: [
                        "ì´ˆì¡°ëŒ€ì¥ê²½ì´ ì™„ì„±ë˜ì–´ ë¶ˆêµ ë¬¸í™”ê°€ ìœµì„±í•˜ì˜€ë‹¤.",
                        "í›ˆë¯¼ì •ìŒì´ ì°½ì œë˜ì–´ í•œê¸€ ë¬¸í™”ê°€ ì‹œì‘ë˜ì—ˆë‹¤.",
                        "ë™êµ­í†µê°ì´ í¸ì°¬ë˜ì–´ ì—­ì‚¬ ì¸ì‹ì´ í™•ë¦½ë˜ì—ˆë‹¤.",
                        "ê²½êµ­ëŒ€ì „ì´ ì™„ì„±ë˜ì–´ ë²•ì „ ì²´ê³„ê°€ ì •ë¹„ë˜ì—ˆë‹¤."
                    ],
                    answer: answerNumbers.length > 2 ? answerNumbers[2] : 3, // ì¶”ì¶œëœ ì •ë‹µë²ˆí˜¸ ì‚¬ìš©
                    examDate: examDate,
                    examType: examType,
                    score: 3,
                    explanation: "ë™êµ­í†µê°ì€ ê³ ë ¤ ì‹œëŒ€ì— í¸ì°¬ëœ ì—­ì‚¬ì„œë¡œ, ì¤‘êµ­ì˜ ì‚¬ë§ˆê´‘ì´ í¸ì°¬í•œ ìì¹˜í†µê°ì„ ëª¨ë²”ìœ¼ë¡œ í•˜ì—¬ ê³ êµ¬ë ¤, ë°±ì œ, ì‹ ë¼ì˜ ì—­ì‚¬ë¥¼ í†µí•©í•˜ì—¬ í¸ì°¬í•œ í†µì‚¬ì…ë‹ˆë‹¤. ì´ëŠ” ê³ ë ¤ì˜ ì—­ì‚¬ ì¸ì‹ê³¼ ë¯¼ì¡± ì˜ì‹ì„ ë³´ì—¬ì£¼ëŠ” ì¤‘ìš”í•œ ë¬¸í™”ìœ ì‚°ì…ë‹ˆë‹¤.",
                    createdAt: new Date().toISOString(),
                    autoGenerated: true,
                    image: null,
                    imageMissing: true,
                    sourceFiles: {
                        questionPDF: uploadedFiles.questionPDF.name,
                        answerPDF: uploadedFiles.answerPDF.name
                    }
                },
                {
                    id: Date.now() + 4,
                    question: `${examDate} ê¸°ì¶œë¬¸ì œ - ì¡°ì„  ì‹œëŒ€ì˜ ê²½ì œ ì •ì±…ì— ëŒ€í•œ ì„¤ëª…ìœ¼ë¡œ ì˜³ì€ ê²ƒì€?`,
                    options: [
                        "ëŒ€ë™ë²•ì´ ì‹¤ì‹œë˜ì–´ ì¡°ì„¸ ì œë„ê°€ ê°œí¸ë˜ì—ˆë‹¤.",
                        "ê³µë²•ì´ ì‹¤ì‹œë˜ì–´ í† ì§€ ì œë„ê°€ ê°œí¸ë˜ì—ˆë‹¤.",
                        "ê· ì—­ë²•ì´ ì‹¤ì‹œë˜ì–´ êµ°ì—­ ì œë„ê°€ ê°œí¸ë˜ì—ˆë‹¤.",
                        "í˜¸ì¡°ë²•ì´ ì‹¤ì‹œë˜ì–´ ì¬ì • ì œë„ê°€ ê°œí¸ë˜ì—ˆë‹¤."
                    ],
                    answer: answerNumbers.length > 3 ? answerNumbers[3] : 4, // ì¶”ì¶œëœ ì •ë‹µë²ˆí˜¸ ì‚¬ìš©
                    examDate: examDate,
                    examType: examType,
                    score: 1,
                    createdAt: new Date().toISOString(),
                    autoGenerated: true,
                    image: null,
                    imageMissing: false,
                    sourceFiles: {
                        questionPDF: uploadedFiles.questionPDF.name,
                        answerPDF: uploadedFiles.answerPDF.name
                    }
                },
                {
                    id: Date.now() + 5,
                    question: `${examDate} ê¸°ì¶œë¬¸ì œ - ê·¼ëŒ€ ì‚¬íšŒì˜ ë³€í™”ì— ëŒ€í•œ ì„¤ëª…ìœ¼ë¡œ ì˜³ì€ ê²ƒì€?`,
                    options: [
                        "ê°œí•­ ì´í›„ ì„œì–‘ ë¬¸ë¬¼ì´ ë„ì…ë˜ì–´ ìƒí™œì´ ë³€í™”í•˜ì˜€ë‹¤.",
                        "ê°‘ì˜¤ê°œí˜ ì´í›„ ì „í†µ ë¬¸í™”ê°€ ë¶€í™œí•˜ì˜€ë‹¤.",
                        "ì„ì‚¬ì¡°ì•½ ì´í›„ ë…ë¦½ ìš´ë™ì´ ì†Œë©¸í•˜ì˜€ë‹¤.",
                        "í•œì¼í•©ë°© ì´í›„ ë¯¼ì¡± ë¬¸í™”ê°€ ë°œì „í•˜ì˜€ë‹¤."
                    ],
                    answer: answerNumbers.length > 4 ? answerNumbers[4] : 1, // ì¶”ì¶œëœ ì •ë‹µë²ˆí˜¸ ì‚¬ìš©
                    examDate: examDate,
                    examType: examType,
                    score: 2,
                    createdAt: new Date().toISOString(),
                    autoGenerated: true,
                    image: null,
                    imageMissing: false,
                    sourceFiles: {
                        questionPDF: uploadedFiles.questionPDF.name,
                        answerPDF: uploadedFiles.answerPDF.name
                    }
                },
                {
                    id: Date.now() + 6,
                    question: `${examDate} ê¸°ì¶œë¬¸ì œ - ì¼ì œ ê°•ì ê¸°ì˜ ë…ë¦½ ìš´ë™ì— ëŒ€í•œ ì„¤ëª…ìœ¼ë¡œ ì˜³ì€ ê²ƒì€?`,
                    options: [
                        "3Â·1ìš´ë™ì€ ë¹„í­ë ¥ í‰í™” ìš´ë™ì´ì—ˆë‹¤.",
                        "ì˜ì—´ë‹¨ì€ ì™¸êµì  ë…ë¦½ ìš´ë™ì„ ì „ê°œí•˜ì˜€ë‹¤.",
                        "ëŒ€í•œë¯¼êµ­ ì„ì‹œì •ë¶€ëŠ” ìƒí•´ì—ì„œë§Œ í™œë™í•˜ì˜€ë‹¤.",
                        "ê´‘ë³µêµ°ì€ êµ­ë‚´ì—ì„œë§Œ í™œë™í•˜ì˜€ë‹¤."
                    ],
                    answer: answerNumbers.length > 5 ? answerNumbers[5] : 4, // ì¶”ì¶œëœ ì •ë‹µë²ˆí˜¸ ì‚¬ìš©
                    examDate: examDate,
                    examType: examType,
                    score: 3,
                    createdAt: new Date().toISOString(),
                    autoGenerated: true,
                    image: null,
                    imageMissing: false,
                    sourceFiles: {
                        questionPDF: uploadedFiles.questionPDF.name,
                        answerPDF: uploadedFiles.answerPDF.name
                    }
                },
                {
                    id: Date.now() + 7,
                    question: `${examDate} ê¸°ì¶œë¬¸ì œ - ëŒ€í•œë¯¼êµ­ ì •ë¶€ ìˆ˜ë¦½ ê³¼ì •ì— ëŒ€í•œ ì„¤ëª…ìœ¼ë¡œ ì˜³ì€ ê²ƒì€?`,
                    options: [
                        "ë¯¸êµ°ì •ì€ 3ë…„ê°„ í•œêµ­ì„ í†µì¹˜í•˜ì˜€ë‹¤.",
                        "ìœ ì—”ì€ í•œêµ­ì˜ ë…ë¦½ì„ ìŠ¹ì¸í•˜ì§€ ì•Šì•˜ë‹¤.",
                        "ëŒ€í•œë¯¼êµ­ ì •ë¶€ëŠ” 1948ë…„ 8ì›” 15ì¼ì— ìˆ˜ë¦½ë˜ì—ˆë‹¤.",
                        "ë¶í•œì€ ë‚¨í•œë³´ë‹¤ ë¨¼ì € ì •ë¶€ë¥¼ ìˆ˜ë¦½í•˜ì˜€ë‹¤."
                    ],
                    answer: answerNumbers.length > 6 ? answerNumbers[6] : 3, // ì¶”ì¶œëœ ì •ë‹µë²ˆí˜¸ ì‚¬ìš©
                    examDate: examDate,
                    examType: examType,
                    score: 1,
                    createdAt: new Date().toISOString(),
                    autoGenerated: true,
                    image: null,
                    imageMissing: false,
                    sourceFiles: {
                        questionPDF: uploadedFiles.questionPDF.name,
                        answerPDF: uploadedFiles.answerPDF.name
                    }
                },
                {
                    id: Date.now() + 8,
                    question: `${examDate} ê¸°ì¶œë¬¸ì œ - 6Â·25 ì „ìŸì— ëŒ€í•œ ì„¤ëª…ìœ¼ë¡œ ì˜³ì€ ê²ƒì€?`,
                    options: [
                        "ì „ìŸì€ 1950ë…„ 6ì›” 25ì¼ì— ì‹œì‘ë˜ì—ˆë‹¤.",
                        "ì¤‘êµ­ì€ ì „ìŸì— ì°¸ì „í•˜ì§€ ì•Šì•˜ë‹¤.",
                        "ìœ ì—”êµ°ì€ ì „ìŸì— ì°¸ì „í•˜ì§€ ì•Šì•˜ë‹¤.",
                        "ì „ìŸì€ 1ë…„ ë§Œì— ì¢…ë£Œë˜ì—ˆë‹¤."
                    ],
                    answer: answerNumbers.length > 7 ? answerNumbers[7] : 1, // ì¶”ì¶œëœ ì •ë‹µë²ˆí˜¸ ì‚¬ìš©
                    examDate: examDate,
                    examType: examType,
                    score: 2,
                    createdAt: new Date().toISOString(),
                    autoGenerated: true,
                    image: null,
                    imageMissing: true,
                    sourceFiles: {
                        questionPDF: uploadedFiles.questionPDF.name,
                        answerPDF: uploadedFiles.answerPDF.name
                    }
                },
                {
                    id: Date.now() + 9,
                    question: `${examDate} ê¸°ì¶œë¬¸ì œ - ê²½ì œ ê°œë°œ ê³¼ì •ì— ëŒ€í•œ ì„¤ëª…ìœ¼ë¡œ ì˜³ì€ ê²ƒì€?`,
                    options: [
                        "1ì°¨ ê²½ì œê°œë°œ 5ê°œë…„ ê³„íšì€ 1962ë…„ë¶€í„° ì‹œì‘ë˜ì—ˆë‹¤.",
                        "ìƒˆë§ˆì„ìš´ë™ì€ ë„ì‹œ ê°œë°œ ìš´ë™ì´ì—ˆë‹¤.",
                        "ì¤‘í™”í•™ê³µì—…ì€ 1970ë…„ëŒ€ì— ì‹œì‘ë˜ì—ˆë‹¤.",
                        "ìˆ˜ì¶œ ì£¼ë„ ê²½ì œëŠ” 1980ë…„ëŒ€ì— ì‹œì‘ë˜ì—ˆë‹¤."
                    ],
                    answer: answerNumbers.length > 8 ? answerNumbers[8] : 1, // ì¶”ì¶œëœ ì •ë‹µë²ˆí˜¸ ì‚¬ìš©
                    examDate: examDate,
                    examType: examType,
                    score: 3,
                    createdAt: new Date().toISOString(),
                    autoGenerated: true,
                    image: null,
                    imageMissing: false,
                    sourceFiles: {
                        questionPDF: uploadedFiles.questionPDF.name,
                        answerPDF: uploadedFiles.answerPDF.name
                    }
                },
                {
                    id: Date.now() + 10,
                    question: `${examDate} ê¸°ì¶œë¬¸ì œ - ë¯¼ì£¼í™” ê³¼ì •ì— ëŒ€í•œ ì„¤ëª…ìœ¼ë¡œ ì˜³ì€ ê²ƒì€?`,
                    options: [
                        "4Â·19 í˜ëª…ì€ 1960ë…„ì— ë°œìƒí•˜ì˜€ë‹¤.",
                        "5Â·18 ë¯¼ì£¼í™”ìš´ë™ì€ 1980ë…„ì— ë°œìƒí•˜ì˜€ë‹¤.",
                        "6ì›” ë¯¼ì£¼í•­ìŸì€ 1987ë…„ì— ë°œìƒí•˜ì˜€ë‹¤.",
                        "ëª¨ë“  ë¯¼ì£¼í™” ìš´ë™ì€ ì„±ê³µí•˜ì˜€ë‹¤."
                    ],
                    answer: answerNumbers.length > 9 ? answerNumbers[9] : 3, // ì¶”ì¶œëœ ì •ë‹µë²ˆí˜¸ ì‚¬ìš©
                    examDate: examDate,
                    examType: examType,
                    score: 2,
                    createdAt: new Date().toISOString(),
                    autoGenerated: true,
                    image: null,
                    imageMissing: false,
                    sourceFiles: {
                        questionPDF: uploadedFiles.questionPDF.name,
                        answerPDF: uploadedFiles.answerPDF.name
                    }
                }
            ];

            // ìë™ ìƒì„±ëœ ë¬¸ì œë“¤ì„ ì €ì¥
            questions = [...questions, ...generatedQuestions];
            localStorage.setItem('koreanHistoryQuestions', JSON.stringify(questions));
        }

        // ì •ë‹µì§€ì—ì„œ ì •ë‹µë²ˆí˜¸ ì¶”ì¶œ ì‹œë®¬ë ˆì´ì…˜
        function simulateAnswerExtraction() {
            // ì‹¤ì œë¡œëŠ” PDFì—ì„œ ì •ë‹µë²ˆí˜¸ë¥¼ ì¶”ì¶œí•˜ëŠ” AI/OCR ë¡œì§ì´ ë“¤ì–´ê°ˆ ìë¦¬
            // í˜„ì¬ëŠ” ì‹œë®¬ë ˆì´ì…˜ì„ ìœ„í•´ ëœë¤í•˜ê²Œ ì •ë‹µë²ˆí˜¸ë¥¼ ìƒì„±í•˜ê±°ë‚˜ ì‹¤íŒ¨ë¥¼ ì‹œë®¬ë ˆì´ì…˜
            
            // ì •ë‹µ ë¶„ì„ ìƒíƒœ ì—…ë°ì´íŠ¸
            updateAnswerAnalysisStatus('ë¶„ì„ ì¤‘...', 'ë¶„ì„ ì¤‘...', 'ë¶„ì„ ì¤‘...');
            
            // 70% í™•ë¥ ë¡œ ì •ë‹µë²ˆí˜¸ ì¶”ì¶œ ì„±ê³µ, 30% í™•ë¥ ë¡œ ì‹¤íŒ¨
            if (Math.random() < 0.7) {
                // ì •ë‹µë²ˆí˜¸ ì¶”ì¶œ ì„±ê³µ ì‹œë®¬ë ˆì´ì…˜
                const answers = [1, 2, 3, 4, 1, 4, 3, 2, 3, 2]; // 10ê°œ ë¬¸ì œì˜ ì •ë‹µë²ˆí˜¸
                updateAnswerAnalysisStatus('âœ… ì„±ê³µ', answers.length + 'ê°œ', 'ì™„ë£Œ');
                return answers;
            } else {
                // ì •ë‹µë²ˆí˜¸ ì¶”ì¶œ ì‹¤íŒ¨ ì‹œë®¬ë ˆì´ì…˜
                updateAnswerAnalysisStatus('âŒ ì‹¤íŒ¨', '0ê°œ', 'ì‹¤íŒ¨');
                return [];
            }
        }

        // ì •ë‹µ ë¶„ì„ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateAnswerAnalysisStatus(extractionStatus, answerCount, analysisStatus) {
            const extractionStatusElement = document.getElementById('answerExtractionStatus');
            const answerCountElement = document.getElementById('extractedAnswerCount');
            const analysisStatusElement = document.getElementById('analysisStatus');
            
            if (extractionStatusElement) {
                extractionStatusElement.textContent = extractionStatus;
                extractionStatusElement.style.color = extractionStatus.includes('ì„±ê³µ') ? '#28a745' : 
                                                   extractionStatus.includes('ì‹¤íŒ¨') ? '#dc3545' : '#666';
            }
            
            if (answerCountElement) {
                answerCountElement.textContent = answerCount;
                answerCountElement.style.color = answerCount === '0ê°œ' ? '#dc3545' : '#28a745';
            }
            
            if (analysisStatusElement) {
                analysisStatusElement.textContent = analysisStatus;
                analysisStatusElement.style.color = analysisStatus === 'ì™„ë£Œ' ? '#28a745' : 
                                                 analysisStatus === 'ì‹¤íŒ¨' ? '#dc3545' : '#666';
            }
        }

        // ë¬¸ì œ ë“±ë¡
        function addQuestion() {
            const questionText = document.getElementById('questionText').value;
            const option1 = document.getElementById('option1').value;
            const option2 = document.getElementById('option2').value;
            const option3 = document.getElementById('option3').value;
            const option4 = document.getElementById('option4').value;
            const correctAnswer = document.getElementById('correctAnswer').value;
            const examDate = document.getElementById('examDateInput').value;
            const examType = document.getElementById('examTypeInput').value;
            const questionScore = document.getElementById('questionScore').value;
            const questionExplanation = document.getElementById('questionExplanation').value;
            const imageFile = document.getElementById('questionImage').files[0];

            if (!questionText || !option1 || !option2 || !option3 || !option4 || !correctAnswer || !examDate || !examType) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ì´ë¯¸ì§€ ì²˜ë¦¬
            let imageUrl = null;
            let imageMissing = false;
            if (imageFile) {
                imageUrl = URL.createObjectURL(imageFile);
            } else {
                imageMissing = true;
            }

            const question = {
                id: Date.now(),
                question: questionText,
                options: [option1, option2, option3, option4],
                answer: parseInt(correctAnswer),
                examDate: examDate,
                examType: examType,
                score: parseInt(questionScore),
                explanation: questionExplanation,
                createdAt: new Date().toISOString(),
                autoGenerated: false,
                image: imageUrl,
                imageMissing: imageMissing
            };

            questions.push(question);
            localStorage.setItem('koreanHistoryQuestions', JSON.stringify(questions));

            // ì‹œí—˜ ì¼ì ì €ì¥
            if (!examDates.includes(examDate)) {
                examDates.push(examDate);
                localStorage.setItem('examDates', JSON.stringify(examDates));
            }

            alert('ë¬¸ì œê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            clearForm();
            displayQuestions();
        }

        // í¼ ì´ˆê¸°í™”
        function clearForm() {
            document.getElementById('questionText').value = '';
            document.getElementById('option1').value = '';
            document.getElementById('option2').value = '';
            document.getElementById('option3').value = '';
            document.getElementById('option4').value = '';
            document.getElementById('correctAnswer').value = '';
            document.getElementById('examDateInput').value = '';
            document.getElementById('examTypeInput').value = '';
            document.getElementById('questionScore').value = '1';
            document.getElementById('questionExplanation').value = '';
            document.getElementById('questionImage').value = '';
        }

        // ë¬¸ì œ ì‚­ì œ
        function deleteQuestion(id) {
            if (confirm('ì •ë§ë¡œ ì´ ë¬¸ì œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                questions = questions.filter(q => q.id !== id);
                localStorage.setItem('koreanHistoryQuestions', JSON.stringify(questions));
                displayQuestions();
                alert('ë¬¸ì œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì „ì²´ ë¬¸ì œ ì„ íƒ
        function selectAllQuestions() {
            const checkboxes = document.querySelectorAll('.question-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
            });
            updateSelectedCount();
        }

        // ì „ì²´ ë¬¸ì œ ì„ íƒ í•´ì œ
        function deselectAllQuestions() {
            const checkboxes = document.querySelectorAll('.question-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            updateSelectedCount();
        }

        // ì„ íƒëœ ë¬¸ì œ ì‚­ì œ
        function deleteSelectedQuestions() {
            const checkboxes = document.querySelectorAll('.question-checkbox:checked');
            if (checkboxes.length === 0) {
                alert('ì‚­ì œí•  ë¬¸ì œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            if (confirm(`ì„ íƒëœ ${checkboxes.length}ê°œì˜ ë¬¸ì œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                const selectedIds = Array.from(checkboxes).map(checkbox => 
                    parseInt(checkbox.id.replace('checkbox_', ''))
                );
                
                questions = questions.filter(q => !selectedIds.includes(q.id));
                localStorage.setItem('koreanHistoryQuestions', JSON.stringify(questions));
                displayQuestions();
                alert(`${checkboxes.length}ê°œì˜ ë¬¸ì œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
            }
        }

        // ì‹œí—˜ì¼ìë³„ ì¼ê´„ ì‚­ì œ
        function deleteQuestionsByDate() {
            const selectedDate = document.getElementById('examDateSelect').value;
            if (!selectedDate) {
                alert('ì‚­ì œí•  ì‹œí—˜ì¼ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const questionsToDelete = questions.filter(q => q.examDate === selectedDate);
            if (questionsToDelete.length === 0) {
                alert('í•´ë‹¹ ì‹œí—˜ì¼ìì— ë“±ë¡ëœ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            if (confirm(`"${selectedDate}" ì‹œí—˜ì¼ìì˜ ${questionsToDelete.length}ê°œ ë¬¸ì œë¥¼ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                questions = questions.filter(q => q.examDate !== selectedDate);
                localStorage.setItem('koreanHistoryQuestions', JSON.stringify(questions));
                
                // ì‹œí—˜ì¼ì ëª©ë¡ì—ì„œë„ ì œê±°
                examDates = examDates.filter(date => date !== selectedDate);
                localStorage.setItem('examDates', JSON.stringify(examDates));
                
                displayQuestions();
                alert(`"${selectedDate}" ì‹œí—˜ì¼ìì˜ ${questionsToDelete.length}ê°œ ë¬¸ì œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
            }
        }

        // ì„ íƒëœ ë¬¸ì œ ìˆ˜ ì—…ë°ì´íŠ¸
        function updateSelectedCount() {
            const checkboxes = document.querySelectorAll('.question-checkbox:checked');
            const selectedCount = document.getElementById('selectedCount');
            selectedCount.textContent = `ì„ íƒëœ ë¬¸ì œ: ${checkboxes.length}ê°œ`;
        }

        // ì‹œí—˜ì¼ì ì„ íƒ ì˜µì…˜ ì—…ë°ì´íŠ¸
        function updateExamDateOptions() {
            const examDateSelect = document.getElementById('examDateSelect');
            if (!examDateSelect) return;
            
            // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²« ë²ˆì§¸ "ì‹œí—˜ì¼ì ì„ íƒ" ì˜µì…˜ ì œì™¸)
            while (examDateSelect.children.length > 1) {
                examDateSelect.removeChild(examDateSelect.lastChild);
            }
            
            // ì‹œí—˜ì¼ìë³„ë¡œ ê·¸ë£¹í™”ëœ ë¬¸ì œ ìˆ˜ ê³„ì‚°
            const dateCounts = {};
            questions.forEach(q => {
                dateCounts[q.examDate] = (dateCounts[q.examDate] || 0) + 1;
            });
            
            // ì‹œí—˜ì¼ì ì˜µì…˜ ì¶”ê°€
            Object.keys(dateCounts).sort().forEach(date => {
                const option = document.createElement('option');
                option.value = date;
                option.textContent = `${date} (${dateCounts[date]}ê°œ ë¬¸ì œ)`;
                examDateSelect.appendChild(option);
            });
        }

        // ë¬¸ì œ ëª©ë¡ í‘œì‹œ
        function displayQuestions() {
            const container = document.getElementById('questionsList');
            
            if (questions.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">ë“±ë¡ëœ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            // ì‹œí—˜ ì¼ìë³„ë¡œ ê·¸ë£¹í™”
            const groupedQuestions = {};
            questions.forEach(q => {
                if (!groupedQuestions[q.examDate]) {
                    groupedQuestions[q.examDate] = [];
                }
                groupedQuestions[q.examDate].push(q);
            });

            let html = '';
            Object.keys(groupedQuestions).forEach(date => {
                html += `<h3 style="color: #ff6b6b; margin-top: 20px;">ğŸ“… ${date}</h3>`;
                groupedQuestions[date].forEach(q => {
                    html += `
                        <div class="question-item ${q.autoGenerated ? 'auto-generated' : ''}">
                            <div class="question-header">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="checkbox_${q.id}" class="question-checkbox" onchange="updateSelectedCount()">
                                    <span class="question-number">ë¬¸ì œ ${q.id}</span>
                                </div>
                                <button class="btn btn-danger" onclick="deleteQuestion(${q.id})">ì‚­ì œ</button>
                            </div>
                            <div class="question-text">
                                <span class="question-score">[${q.score}ì ]</span> ${q.question}
                            </div>
                            ${q.image ? `<img src="${q.image}" alt="ë¬¸ì œ ì´ë¯¸ì§€" class="question-image">` : ''}
                            ${q.imageMissing ? '<div class="image-missing">ì´ ë¬¸ì œëŠ” ì´ë¯¸ì§€ê°€ ëˆ„ë½ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</div>' : ''}
                            <ul class="options-list">
                                ${q.options.map((option, index) => 
                                    `<li>${index + 1}. ${option} ${index + 1 === q.answer ? '<span class="correct-answer">(ì •ë‹µ)</span>' : ''}</li>`
                                ).join('')}
                            </ul>
                            ${q.sourceFiles ? `
                                <div style="margin-top: 10px; font-size: 0.9em; color: #666;">
                                    ğŸ“ ì¶œì²˜: ${q.sourceFiles.questionPDF}, ${q.sourceFiles.answerPDF}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
            });

            container.innerHTML = html;
            
            // ì‹œí—˜ì¼ì ì„ íƒ ì˜µì…˜ ì—…ë°ì´íŠ¸
            updateExamDateOptions();
        }

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ê¸°ëŠ¥
        const questionUploadArea = document.getElementById('questionUploadArea');
        const answerUploadArea = document.getElementById('answerUploadArea');
        
        [questionUploadArea, answerUploadArea].forEach(area => {
            area.addEventListener('dragover', (e) => {
                e.preventDefault();
                area.style.borderColor = '#ff6b6b';
                area.style.background = '#fff5f5';
            });

            area.addEventListener('dragleave', (e) => {
                e.preventDefault();
                area.style.borderColor = '#ddd';
                area.style.background = '#fafafa';
            });

            area.addEventListener('drop', (e) => {
                e.preventDefault();
                area.style.borderColor = '#ddd';
                area.style.background = '#fafafa';
                
                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].type === 'application/pdf') {
                    const fileType = area.id === 'questionUploadArea' ? 'questionPDF' : 'answerPDF';
                    const fileInput = document.getElementById(fileType === 'questionPDF' ? 'questionPDF' : 'answerPDF');
                    fileInput.files = files;
                    handleFileUpload({ target: fileInput }, fileType);
                } else {
                    alert('PDF íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                }
            });
        });
    </script>
</body>
</html>
